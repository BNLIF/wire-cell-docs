<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://BNLIF.github.io/wire-cell-docs/dev/data/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Persistency - Wire Cell Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Persistency";
        var mkdocs_page_input_path = "dev/data.md";
        var mkdocs_page_url = "/wire-cell-docs/dev/data/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Wire Cell Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Overview</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../install/install/">Install Wire Cell</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../install/external/">Install Externals</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev/">Building</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../iface/">Interfaces</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Persistency</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#generalities">Generalities</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#geometry">Geometry</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#channel">Channel</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cell">Cell</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../test/">Testing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Algorithms</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../alg/cell/">Making Cells</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alg/blob/">Blob Reconstruction</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Visualization</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../viz/bee/">Bee</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../viz/uploads/">User Uploads</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Meta</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../meta/meta/">About</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Wire Cell Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Developer</li>
      <li class="breadcrumb-item active">Persistency</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/BNLIF/wire-cell-docs/edit/master/docs/dev/data.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Wire Cell has a simple ROOT I/O persistency module.  </p>
<h1 id="schema">Schema</h1>
<p>The data is saved to several ROOT TFiles is shown in the following
figure.  Refer to the <a href="#terms">terms</a> section for a nomenclature.</p>
<p><img alt="rootdata" src="../../img/rootdata.svg" /></p>
<p>([<a href="../../img/rootdata.png">PNG</a>], [<a href="../../img/rootdata.pdf">PDF</a>], [<a href="../../img/rootdata.dot">DOT</a>] and [<a href="../../img/rootdata.svg">SVG</a>])</p>
<h2 id="generalities">Generalities</h2>
<p>To store the data into a ROOT file we must take care of ownership and
references explicitly.  In general this is handled by representing
ownership as an array of objects and references as an index into this
array.</p>
<p>There are three trees: Geometry, Channel and Cell.</p>
<h2 id="geometry">Geometry</h2>
<p>The geometry is saved into a tree with a single entry.  There are
three owning arrays, <code>WireStore</code>, <code>PointStore</code> and <code>TilingStore</code>
owning:</p>
<ul>
<li>
<p><code>Wire</code> with associated channel ID number (referred to in the
Channel data tree) and two end points</p>
</li>
<li>
<p><code>Point</code> all 3d Points referred to by other objects.</p>
</li>
<li>
<p><code>Cell</code> associates a Wire via it's index (<code>wid</code>) with a center
  point and an (ordered) array of points that make up the corners of
  the cell.</p>
</li>
</ul>
<h2 id="channel">Channel</h2>
<p>Information about charge read out from all channels in a frame.  One
entry in this branch spans an entire readout frame.</p>
<ul>
<li>
<p><code>ChannelStore</code> holds all channel data for the frame</p>
</li>
<li>
<p><code>ChannelSlice</code> associates a time bin <code>tbin</code> that counts relative
to the start of the frame with a collection of read out channel
charges.  A negative charge is undefined.</p>
</li>
<li>
<p><code>ChannelCharge</code> associates a channel ID with a charge.</p>
</li>
</ul>
<h2 id="cell">Cell</h2>
<p>The Cell branch holds associations between charge and cells and groups
of cells.  This branch may hold MC truth value or reconstruction.</p>
<ul>
<li>
<p><code>CellCharge</code> associates a cell ID, which is an index into the
  <code>TilingStore</code> with a charge.  A negative charge is undefined.</p>
</li>
<li>
<p><code>Blob</code> owns an array of <code>CellCharge</code>.  The <code>technique</code> is a user
  defined string to label the origin of the blob (eg, "simtruth" or
  maybe "2dtoyreco", etc).  The <code>tbin</code> counts the time bin from the
  beginning of the frame, the <code>qtot</code> is some measure of the charge for
  the blob as a whole (and may not necessarily be the sum of the
  charge on the individual cells).  The <code>quality</code>is a
  <code>technique</code>-specific measure of quality and finally the array of
  cell charge.</p>
</li>
<li>
<p><code>BlobCluster</code> is a (non-owning) association of blobs.  This may be
  used to collect blobs together within one time slice or may be used
  to collect them together across multiple time slices such as to form
  the blobs contributing to a track or a shower.  Blobs are referenced
  by their index into the frame's <code>BlobStore</code>.  All available
  <code>BlobClusters</code> are stored in the <code>ClusterStore</code></p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../iface/" class="btn btn-neutral float-left" title="Interfaces"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../test/" class="btn btn-neutral float-right" title="Testing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/BNLIF/wire-cell-docs/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../iface/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../test/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
